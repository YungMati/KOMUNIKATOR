<!-- ... dotychczasowy kod head i style bez zmian ... -->

<style>
  /* Dodane style dla listy użytkowników */
  #chatLayout {
    display: flex;
    height: 100vh;
  }

  #chatMain {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 10px;
  }

  #userList {
    width: 140px;
    background: #1e2124;
    color: #ffffff;
    padding: 10px;
    overflow-y: auto;
    border-left: 1px solid #333;
  }

  #userList h3 {
    font-size: 14px;
    margin-bottom: 10px;
    color: #aaa;
  }

  .userOnline {
    font-size: 14px;
    padding: 4px 0;
    color: #4f90e2;
  }
</style>
</head>
<body>

<!-- ... Ekrany logowania i kodu dostępu bez zmian ... -->

<div id="chat" style="display:none;">
  <div id="chatLayout">
    <div id="chatMain">
      <div id="messages"></div>
      <div id="inputContainer">
        <input type="text" id="messageInput" placeholder="Napisz wiadomość...">
        <button id="sendBtn">➤</button>
      </div>
    </div>
    <div id="userList">
      <h3>Online:</h3>
      <div id="usersOnline"></div>
    </div>
  </div>
</div>

<script>
  const ws = new WebSocket("wss://komunikator-web.onrender.com");

  const accessCodeInput = document.getElementById("accessCodeInput");
  const accessBtn = document.getElementById("accessBtn");
  const accessError = document.getElementById("accessError");
  const loginScreen = document.getElementById("loginScreen");
  const accessScreen = document.getElementById("accessScreen");

  const usernameInput = document.getElementById("usernameInput");
  const passwordInput = document.getElementById("passwordInput");
  const loginBtn = document.getElementById("loginBtn");
  const loginError = document.getElementById("loginError");

  const chat = document.getElementById("chat");
  const messages = document.getElementById("messages");
  const messageInput = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");
  const usersOnline = document.getElementById("usersOnline");

  let username = "";

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if (data.type === "access_code") {
      accessError.textContent = data.status === "ok" ? "" : "Niepoprawny kod dostępu.";
      if (data.status === "ok") {
        accessScreen.style.display = "none";
        loginScreen.style.display = "block";
      }
    }

    if (data.type === "login") {
      loginError.textContent = data.status === "ok" ? "" : "Błędne dane logowania.";
      if (data.status === "ok") {
        loginScreen.style.display = "none";
        chat.style.display = "flex";
        username = usernameInput.value;
      }
    }

    if (data.type === "message") {
      const div = document.createElement("div");
      div.classList.add("message");

      const user = document.createElement("div");
      user.classList.add("user");
      user.textContent = data.username;

      const text = document.createElement("div");
      text.classList.add("text");
      text.textContent = data.text;

      div.appendChild(user);
      div.appendChild(text);
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    if (data.type === "users_online") {
      usersOnline.innerHTML = "";
      data.users.forEach(user => {
        const el = document.createElement("div");
        el.classList.add("userOnline");
        el.textContent = user;
        usersOnline.appendChild(el);
      });
    }

    if (data.type === "history") {
      data.messages.forEach(msg => {
        const div = document.createElement("div");
        div.classList.add("message");

        const user = document.createElement("div");
        user.classList.add("user");
        user.textContent = msg.username;

        const text = document.createElement("div");
        text.classList.add("text");
        text.textContent = msg.text;

        div.appendChild(user);
        div.appendChild(text);
        messages.appendChild(div);
      });
      messages.scrollTop = messages.scrollHeight;
    }
  };

  accessBtn.onclick = () => {
    const code = accessCodeInput.value.trim();
    if (!code) {
      accessError.textContent = "Wpisz kod dostępu!";
      return;
    }
    ws.send(JSON.stringify({ type: "access_code", code }));
  };

  loginBtn.onclick = () => {
    const user = usernameInput.value.trim();
    const pass = passwordInput.value.trim();
    if (!user || !pass) {
      loginError.textContent = "Wpisz dane logowania!";
      return;
    }
    ws.send(JSON.stringify({ type: "login", username: user, password: pass }));
  };

  sendBtn.onclick = () => {
    const text = messageInput.value.trim();
    if (!text) return;
    ws.send(JSON.stringify({ type: "message", text }));
    messageInput.value = "";
  };

  messageInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendBtn.click();
  });
</script>
</body>
</html>
